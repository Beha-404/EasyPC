<div class="mainDiv">
    <div class="navBar">
        <app-nav-bar></app-nav-bar>
    </div>

    <div class="editProfile">
        <div><button (click)="changeLanguage()">{{ 'APP.LANGUAGE' | translate }}</button></div>
        <div>
            <h1>{{ 'EDIT_PROFILE.TITLE' | translate }}</h1>
        </div>
        <form #editProfileForm="ngForm" class="editProfileForm" (ngSubmit)="submitChanges()">
            <table class="editNameTable">
                <tr>
                    <td>
                        <div class="input-container">
                            <label for="firstName">{{ 'EDIT_PROFILE.FIRST_NAME' | translate }}</label>
                            <input type="text" id="firstName" [(ngModel)]="user.firstName" name="firstName"
                                placeholder="Ex. John" minlength="2" required maxlength="40"
                                #firstNameModel="ngModel" />
                            <div>
                                <span *ngIf="firstNameModel.invalid && firstNameModel.touched" class="error">
                                    <span *ngIf="firstNameModel.errors?.['required']">{{ 'EDIT_PROFILE.ERROR_REQUIRED' | translate }}</span>
                                    <span *ngIf="firstNameModel.errors?.['minlength']">{{ 'EDIT_PROFILE.ERROR_MINLENGTH' | translate }}</span>
                                    <span *ngIf="firstNameModel.errors?.['maxlength']">{{ 'EDIT_PROFILE.ERROR_MAXLENGTH' | translate }}</span>
                                </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="input-container">
                            <label for="lastName">{{ 'EDIT_PROFILE.LAST_NAME' | translate }}</label>
                            <input type="text" id="lastName" [(ngModel)]="user.lastName" name="lastName"
                                placeholder="Ex. Doe" minlength="2" required maxlength="40" #lastNameModel="ngModel" />
                            <div>
                                <span *ngIf="lastNameModel.invalid && lastNameModel.touched" class="error">
                                    <span *ngIf="lastNameModel.errors?.['required']">{{ 'EDIT_PROFILE.ERROR_REQUIRED' | translate }}</span>
                                    <span *ngIf="lastNameModel.errors?.['minlength']">{{ 'EDIT_PROFILE.ERROR_MINLENGTH' | translate }}</span>
                                    <span *ngIf="lastNameModel.errors?.['maxlength']">{{ 'EDIT_PROFILE.ERROR_MAXLENGTH' | translate }}</span>
                                </span>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>

            <table class="editResidenceTable">
                <tr>
                    <td>
                        <div class="input-container">
                            <label for="city">{{ 'EDIT_PROFILE.CITY' | translate }}</label>
                            <input type="text" id="city" [(ngModel)]="user.city" name="city"
                                placeholder="Ex. San Francisco" minlength="2" required maxlength="40" #cityModel="ngModel"/>
                            <div>
                                <span *ngIf="cityModel.invalid && cityModel.touched" class="error">
                                    <span *ngIf="cityModel.errors?.['required']">{{ 'EDIT_PROFILE.ERROR_REQUIRED' | translate }}</span>
                                    <span *ngIf="cityModel.errors?.['minlength']">{{ 'EDIT_PROFILE.ERROR_MINLENGTH' | translate }}</span>
                                    <span *ngIf="cityModel.errors?.['maxlength']">{{ 'EDIT_PROFILE.ERROR_MAXLENGTH' | translate }}</span>
                                </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="input-container">
                            <label for="state">{{ 'EDIT_PROFILE.STATE' | translate }}</label>
                            <input type="text" id="state" [(ngModel)]="user.state" name="state"
                                placeholder="Ex. California" minlength="2" required maxlength="40" #stateModel="ngModel"/>
                            <div>
                                <span *ngIf="stateModel.invalid && stateModel.touched" class="error">
                                    <span *ngIf="stateModel.errors?.['required']">{{ 'EDIT_PROFILE.ERROR_REQUIRED' | translate }}</span>
                                    <span *ngIf="stateModel.errors?.['minlength']">{{ 'EDIT_PROFILE.ERROR_MINLENGTH' | translate }}</span>
                                    <span *ngIf="stateModel.errors?.['maxlength']">{{ 'EDIT_PROFILE.ERROR_MAXLENGTH' | translate }}</span>
                                </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="input-container">
                            <label for="postalCode">{{ 'EDIT_PROFILE.POSTAL_CODE' | translate }}</label>
                            <input type="text" id="postalCode" maxlength="5" [(ngModel)]="user.postalCode"
                                name="postalCode" placeholder="Ex. 94105" required #postalCodeModel="ngModel"/>
                            <div>
                                <span *ngIf="postalCodeModel.invalid && postalCodeModel.touched" class="error">
                                    <span *ngIf="postalCodeModel.errors?.['required']">{{ 'EDIT_PROFILE.ERROR_REQUIRED' | translate }}</span>
                                    <span *ngIf="postalCodeModel.errors?.['maxlength']">{{ 'EDIT_PROFILE.ERROR_MAXLENGTH' | translate }}</span>
                                </span>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>

            <div class="input-container">
                <label for="country">{{ 'EDIT_PROFILE.COUNTRY' | translate }}</label>
                <input class="country" [(ngModel)]="user.country" name="country" id="country" placeholder="Ex. USA"
                    minlength="2" required maxlength="40" #countryModel="ngModel"/>
                <div>
                    <span *ngIf="countryModel.invalid && countryModel.touched" class="error">
                        <span *ngIf="countryModel.errors?.['required']">{{ 'EDIT_PROFILE.ERROR_REQUIRED' | translate }}</span>
                        <span *ngIf="countryModel.errors?.['minlength']">{{ 'EDIT_PROFILE.ERROR_MINLENGTH' | translate }}</span>
                        <span *ngIf="countryModel.errors?.['maxlength']">{{ 'EDIT_PROFILE.ERROR_MAXLENGTH' | translate }}</span>
                    </span>
                </div>
            </div>
            <hr>
            <div>
                <p>{{ 'EDIT_PROFILE.PROFILE_PICTURE' | translate }}</p>
            </div>
            <div id="profile-container" class="profile-container">
                <div class="current-profile">
                    <p>{{ 'EDIT_PROFILE.CURRENT' | translate }}</p>
                    <img *ngIf="originalUser.profilePicture"
                        [src]="'data:image/;base64,' + originalUser.profilePicture" />
                </div>

                <div id="dropArea" class="drop-area" (click)="triggerFileInput()" (dragover)="onDragOver($event)"
                    (dragleave)="onDragLeave()" (drop)="onDrop($event)">
                    <ng-container *ngIf="previewURL; else noPreview">
                        <div id="preview">
                            <img *ngIf="previewURL" [src]="previewURL" alt="Preview" />
                        </div>
                    </ng-container>
                    <ng-template #noPreview>
                        <p>Drag & Drop your new image here or <span>click to select image</span></p>
                        <input type="file" id="profilePicture" (change)="onSelectedFile($event)" accept="image/*"
                            hidden />
                    </ng-template>
                </div>
            </div>
            <div class="buttons">
                <div class="left-buttons">
                    <button class="acceptBtn" type="submit">{{ 'EDIT_PROFILE.ACCEPT_CHANGES' | translate }}</button>
                    <button class="cancelBtn" type="button" (click)="resetChanges()">{{ 'EDIT_PROFILE.CANCEL_CHANGES' |
                        translate }}</button>
                </div>
                <ng-container *ngIf="!openDeleteForm">
                    <button class="deleteBtn" type="button" (click)="toggleDeleteForm()">{{
                        'EDIT_PROFILE.DELETE_PROFILE' | translate }}</button>
                </ng-container>
            </div>
            <ng-container *ngIf="openDeleteForm">
                <div class="delete-form">
                    <p>{{ 'EDIT_PROFILE.DELETE_CONFIRMATION' | translate }}</p>
                    <div class="confirmationButtons">
                        <button class="deleteConfirmBtn" type="button" (click)="deleteProfile()">{{
                            'EDIT_PROFILE.DELETE_CONFIRM' | translate }}</button>
                        <button class="cancelDeleteBtn" type="button" (click)="toggleDeleteForm()">{{
                            'EDIT_PROFILE.CANCEL' | translate }}</button>
                    </div>
                </div>
            </ng-container>
        </form>
    </div>
</div>